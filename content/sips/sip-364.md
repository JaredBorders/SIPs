---
sip: 364
title: Perps V3 - Integrator Requests
network:  Base
status: Draft
type: Governance
author: Kaleb (@kaleb-keny)
---

## Simple Summary

The sip proposes to incorporate the following into Perps V3:
- Incorporate a `getOpenPositionSize` that returns the size of a open position given a market id and account number as an input.
- Emit the remaining usd margin amount, for an account when he is flagged for liquidation  
- Incorporate settlement fees into the `getRequiredMarginWithNewPosition` 
- Incorporate a view function that returns the  keeping costs `getSettlementKeeperCosts`

## Abstract

<!--A short (~200 word) description of the proposed change, the abstract should clearly describe the proposed change. This is what *will* be done if the SIP is implemented, not *why* it should be done or *how* it will be done. If the SIP proposes deploying a new contract, write, "we propose to deploy a new contract that will do x".-->

- `getOpenPositionSize` is a view function that reads on the storage slot that holds the keepers position information
- A event emitted under [here](https://github.com/Synthetixio/synthetix-v3/blob/main/markets/perps-market/contracts/modules/LiquidationModule.sol#L55) which includes the users' USD margin at flagging as well as the timestamp of liquidation (to help retrieve the estimated pyth prices)
- Incorporate into `getRequiredMarginWithNewPosition` can be done [getKeeperRewardsAndCosts](https://github.com/Synthetixio/synthetix-v3/blob/main/markets/perps-market/contracts/storage/AsyncOrder.sol#L560) function
- Create a view functions that takes returns the [keeping cost](https://github.com/Synthetixio/synthetix-v3/blob/main/markets/perps-market/contracts/storage/KeeperCosts.sol#L41) associated with a async order 

## Motivation

- Currently getting an idea about open positions requires a pyth price update. However market makers requested for a function that is able to query the state of their position without having to update a price update, as a fallback when a situation arises where pythnet is not operational.
- Integrators requested that the total margin in usd be emitted as an event, when the trader is flagged for liquidation. This would help keep track of the necessary accounting for traders, especially a liquidation event.
- Settlement fees can be significant for small accounts and therefore integrators that query the required margin via the `requiredMarginForOrder` function would not be setting aside the necessary margin that would allow a traders' committed trade to go through. Hence the need to include settlement fees into the margin requirement.
- Integrators looking to show the user the costs of executing a trade need this function. Currently there is a workaround by querying the node with a given argument, however, it is unclean especially in situations where the node configuration is modified 

## Specification

Pending

## Test Cases

Pending



## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
